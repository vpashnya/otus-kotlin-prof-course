import kotlin.concurrent.thread
import kotlin.test.Test

/**
 * Класс для демонстрации базовой работы с потоками (Thread).
 * Поток — это наименьшая единица выполнения, которую можно планировать для выполнения операционной системой.
 * В этом примере мы создадим дополнительный поток для выполнения фоновой задачи.
 */
class Ex1Thread {

  /**
   * Тестовый метод, демонстрирующий создание, запуск и ожидание завершения потока.
   */
  @Test
  fun thr() {
    // 1. Создаем и запускаем новый поток с помощью стандартной функции Kotlin 'thread'.
    //    Блок кода в фигурных скобках {} будет выполняться в этом новом потоке.
    //    Функция 'thread' возвращает объект типа Thread.
    thread {
      // Этот код выполняется в НОВОМ потоке.
      println("Hello, thread started") // Сообщение о старте нового потока.

      // 2. Используем try-catch для обработки исключений, которые могут произойти внутри потока.
      //    Это важно, так как необработанное исключение в потоке приведет к его завершению,
      //    но не остановит все приложение (в отличие от главного потока).
      try {
        // 3. Создаем цикл, который имитирует какую-то работу.
        for (i in 1..10) {
          println("i = $i") // Выводим счетчик на каждой итерации.
          Thread.sleep(100) // Приостанавливаем текущий (НОВЫЙ) поток на 100 миллисекунд.

          // 4. Искусственно вызываем ошибку, когда счетчик достигнет 6.
          if (i == 6) throw RuntimeException("Some error")
        }
      } catch (e: Exception) {
        // 5. Этот блок выполнится, когда в блоке 'try' произойдет исключение.
        //    Он перехватит ошибку и позволит потоку завершиться "грациозно",
        //    а не аварийно.
        println("Exception caught in thread: ${e.message}")
      }
    }.join() // 6. Вызываем метод .join() у объекта потока. Это БЛОКИРУЮЩАЯ операция для ГЛАВНОГО потока.
    //    Главный поток (в котором выполняется тест) будет ждать здесь,
    //    пока созданный нами новый поток не завершит свою работу.
    //    Это необходимо, чтобы тест не завершился раньше, чем успеет отработать фоновый поток.

    // 7. Эта строка будет выполнена ГЛАВНЫМ потоком ТОЛЬКО ПОСЛЕ того, как новый поток завершится.
    println("Thread complete")
  }
}